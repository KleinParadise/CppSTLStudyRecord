# 二级空间配置器
  1. 原理
  * 二级空间配置器使用内存池+自由链表的形式。避免了小块内存带来的碎片化的问题。
  
  2. 逻辑步骤
     1. 判断n是否大于128，如果大于128则直接调用一级空间配置器。如果不大于，则将n上调至8的倍数处，然后再去自由链表中相应的结点下面找，如果该结点下面挂有未使用的内存，则摘下来直接返回这块空间的地址。否则的话我们就要调用refill(size_t n)函数去内存池中申请。
     1. 向内存池申请的时候可以多申请几个，STL默认一次申请nobjs=20个，将多余的挂在自由链表上，这样能够提高效率。
     进入refill函数后，先调chunk_alloc(size_t n,size_t& nobjs)函数去内存池中申请，如果申请成功的话，再回到refill函数。这时候就有两种情况，如果nobjs=1的话则表示内存池只够分配一个，这时候只需要返回这个地址就可以了。否则就表示nobjs大于1，则将多余的内存块挂到自由链表上。如果chunk_alloc失败的话，在他内部有处理机制。
     1. 进入chunk_alloc(size_t n,size_t& nobjs )向内存池申请空间的话有三种情况：
        1. 内存池剩余的空间足够nobjs*n这么大的空间，则直接分配好返回就可以了。
        1. 内存池剩余的空间leftAlloc的范围是n<=leftAlloc<nobjs*n,则这时候就分配nobjs=(leftAlloc)/n这么多个的空间返回。
        1. 内存池中剩余的空间连一个n都不够了，这时候就要向heap申请内存，不过在申请之前先要将内存池中剩余的内存挂到自由链表上，之后再向heap申请。
           - 如果申请成功的话，则就再调一次chunk_alloc重新分配。如果不成功的话，这时候再去自由链表中看看有没有比n大的空间，如果有就将这块空间还给内存池，然后再调一次chunk_alloc重新分配。如果没有的话，则就调用一级空间配置器分配，看看内存不足处理机制能否处理。
           
           
 3. 流程图
    ![red_black_2](https://github.com/KleinParadise/CppSTLStudyRecord/blob/master/image/m_twoalloc.png)
           
           
